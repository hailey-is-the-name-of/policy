
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê½ƒ vs ê³µì • ëŒ€êµ¬ ì •ë‹¹ ì§€ì§€ìœ¨ ì¢…í•© ì‹œê°í™”</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5"></script>
  <style>
    body { font-family: 'Noto Sans KR', sans-serif; margin: 0; background: #f5f7fa; }
    h2 { text-align: center; margin-top: 20px; color: #333; }
    .chart-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; padding: 20px; }
    .chart-box { width: 45%; min-width: 350px; height: 400px; background: white; border-radius: 8px; box-shadow: 0 0 8px rgba(0,0,0,0.05); padding: 10px; }
    .tabs { text-align: center; margin: 20px auto; }
    .tabs button {
      padding: 10px 20px;
      margin: 0 5px;
      border: none;
      background: #ddd;
      border-radius: 5px;
      cursor: pointer;
    }
    .tabs button.active { background: #015DA9; color: white; }
    @media (max-width: 768px) {
      .chart-box { width: 100%; }
    }
  </style>
</head>
<body>
  <h2>ğŸŒ¸ ê½ƒ vs âš–ï¸ ê³µì • ëŒ€êµ¬ ì •ë‹¹ ì§€ì§€ìœ¨ ì¢…í•© ì‹œê°í™”</h2>
  <div class="tabs">
    <button class="tab-button active" data-org="ê½ƒ">ğŸŒ¸ ê½ƒ</button>
    <button class="tab-button" data-org="ê³µì •">âš–ï¸ ê³µì •</button>
  </div>
  <div class="chart-container">
    <div id="lineChart" class="chart-box"></div>
    <div id="areaChart" class="chart-box"></div>
    <div id="barChart" class="chart-box"></div>
    <div id="pieChart" class="chart-box"></div>
  </div>

  <script>
    let fullData = {};
    let currentOrg = 'ê½ƒ';

    const lineChart = echarts.init(document.getElementById('lineChart'));
    const areaChart = echarts.init(document.getElementById('areaChart'));
    const barChart = echarts.init(document.getElementById('barChart'));
    const pieChart = echarts.init(document.getElementById('pieChart'));

    fetch('line_growth_flower_fair.json')
      .then(res => res.json())
      .then(json => {
        fullData = json;
        renderAllCharts(currentOrg);
      });

    function renderAllCharts(org) {
      const data = fullData[org];
      const dates = data.dates;
      const series = data.series;

      // 1. ì„ í˜• ë¹„êµ ì°¨íŠ¸
      lineChart.setOption({
        title: { text: `[${org}] ì„ í˜• ì¶”ì´`, left: 'center' },
        tooltip: { trigger: 'axis' },
        legend: { top: 30 },
        xAxis: { type: 'category', data: dates },
        yAxis: { type: 'value', max: 60 },
        series: series.map(s => ({
          ...s,
          smooth: false,
          showSymbol: true,
          symbolSize: 6,
          label: { show: false }
        }))
      });

      // 2. ëˆ„ì  ì˜ì—­ ì°¨íŠ¸
      areaChart.setOption({
        title: { text: `[${org}] ëˆ„ì  ì˜ì—­`, left: 'center' },
        tooltip: { trigger: 'axis' },
        legend: { top: 30 },
        xAxis: { type: 'category', data: dates },
        yAxis: { type: 'value', max: 60 },
        series: series.map(s => ({
          ...s,
          type: 'line',
          areaStyle: {},
          stack: 'total',
          smooth: true,
          showSymbol: false
        }))
      });

      // 3. ë°” ì°¨íŠ¸ (ìµœì¢… ì‹œì  ë¹„êµ)
      const latest = dates.length - 1;
      barChart.setOption({
        title: { text: `[${org}] ë§ˆì§€ë§‰ ì§€ì  ë¹„êµ`, left: 'center' },
        tooltip: { trigger: 'item' },
        xAxis: { type: 'category', data: series.map(s => s.name) },
        yAxis: { type: 'value', max: 60 },
        series: [{
          type: 'bar',
          data: series.map(s => s.data[latest]),
          itemStyle: {
            color: (params) => params.name === 'ë”ë¶ˆì–´ë¯¼ì£¼ë‹¹' ? '#015DA9' : '#D93A2F'
          },
          label: { show: true, position: 'top', formatter: '{c}%' }
        }]
      });

      // 4. íŒŒì´ì°¨íŠ¸ (í‰ê·  ì§€ì§€ìœ¨)
      const pieData = series.map(s => {
        const avg = s.data.reduce((a, b) => a + (b || 0), 0) / s.data.length;
        return { name: s.name, value: Math.round(avg * 10) / 10 };
      });
      pieChart.setOption({
        title: { text: `[${org}] í‰ê·  ì§€ì§€ìœ¨`, left: 'center' },
        tooltip: { trigger: 'item' },
        legend: { bottom: 0 },
        series: [{
          type: 'pie',
          radius: '55%',
          data: pieData,
          label: { formatter: '{b}: {c}%' }
        }]
      });
    }

    document.querySelectorAll('.tab-button').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentOrg = this.dataset.org;
        renderAllCharts(currentOrg);
      });
    });
  </script>
</body>
</html>
